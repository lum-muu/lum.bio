# Anti-Theft Protection System

_Summary of the deterrents currently shipping with Lum.bio._

## Layers

1) **Integrity verification** – Dual hashes (FNV-1a + SHA-256) on `src/content/_aggregated.json`, validated at runtime.
2) **Digital fingerprinting** – Build metadata injected into the DOM (comment + `meta[name="build-id"]` + `data-build-id` attributes) and exposed via `window.__LUM_BUILD_FINGERPRINT__`.
3) **Code hardening** – Production bundles use Terser with toplevel mangling, debugger removal, and console stripping (whitelisted via `secureConsole` when needed).
4) **Domain verification** – Allowlist (strings, wildcards, regex) with a blocking overlay and console notice on unauthorized hosts.

## Integrity

- Hashes are generated by `scripts/build-data.js` and stored alongside `_buildTime`.
- `npm run integrity:check` recomputes both; `-- --write` updates stored values after intentional content edits.
- `src/data/mockData.ts` validates the hashes on load and surfaces the status through the UI (Status Bar / warning overlay).

## Fingerprinting

- `scripts/inject-fingerprint.js` sets build IDs/timestamps/signatures and feeds Vite defines used by `src/utils/fingerprint.ts`.
- `injectAllFingerprints` writes a DOM comment, a `meta[name="build-id"]`, `data-build-id` attributes on `<body>`, CSS custom properties, and `window.__LUM_BUILD_FINGERPRINT__`.
- Console copyright messaging reads the active fingerprint for traceability.

## Code Hardening

- `vite.config.ts` switches production minification to Terser with toplevel mangling, multi-pass compression, and `drop_console: true`/`drop_debugger: true`.
- Manual chunk aliases keep vendor bundles small and predictable; source maps remain disabled in production (enabled in dev).

## Domain Verification

- Default allowlist lives in `src/utils/domainCheck.ts` and can be extended via `VITE_ALLOWED_DOMAINS` (comma-separated, supports regex/wildcards).
- Unauthorized hosts toggle `shouldBlock`, rendering a non-interactive overlay plus console warnings via `secureConsole`.

For operational steps (hash refresh, fingerprint injection, or allowlist updates), see `docs/INTEGRITY.md`, `scripts/inject-fingerprint.js`, and `src/utils/domainCheck.ts`.
